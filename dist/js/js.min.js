angular.module("scrapsApp",["ui.router","bootstrapLightbox","ngAnimate"]).run(function(e,t,n){e.$state=t,e.$stateParams=n}).config(function(e,t,n){e.otherwise("/"),t.state("home",{url:"/",templateUrl:"features/home/homeView.html",controller:"homeCtrl",resolve:{currentUser:function(e,t){return e.getCurrentUser()["catch"](function(e){return null})},photosForCollage:function(e){return e.getPhotos().then(function(e){return console.log(e),e})}}}).state("login",{url:"/login",templateUrl:"features/auth/loginView.html",caseInsensitve:!0,controller:"authCtrl",resolve:{currentUser:function(e,t){return e.getCurrentUser()["catch"](function(e){return null})}}}).state("register",{url:"/register",templateUrl:"features/auth/registerView.html",caseInsensitve:!0,controller:"authCtrl",resolve:{currentUser:function(e,t){return e.getCurrentUser()["catch"](function(e){return null})}}}).state("profile",{url:"/user/:username",templateUrl:"features/user/userProfileView.html",controller:"userCtrl",caseInsensitve:!0,resolve:{currentUser:function(e,t){return e.getCurrentUser()["catch"](function(e){return null})},checkUserExists:function(e,t,n){return e.getUserInfo(t.username).then(function(e){e||n.go("home")})},userInfo:function(e,t){return e.getUserInfo(t.username)}}}).state("accountSettings",{url:"/account/settings",templateUrl:"features/settings/accountSettingsView.html",caseInsensitve:!0,controller:"settingsCtrl",resolve:{currentUser:function(e,t){return e.getCurrentUser().then(function(e){return e||t.go("login"),e})}}}).state("following",{url:"/following",templateUrl:"features/following/followingView.html",controller:"followingCtrl",caseInsensitve:!0,resolve:{currentUser:function(e,t){return e.getCurrentUser().then(function(e){return e||t.go("login"),e})},getFollowingPosts:function(e){return e.getFollowingPosts()}}}),n.html5Mode(!0)}),angular.module("scrapsApp").directive("checkFollowingLikes",function(){return{restrict:"A",link:function(e,t,n){-1!=e.post.likes.indexOf(e.currentUser._id)&&(e.liked=!0,e.like=!1)}}}),angular.module("scrapsApp").directive("checkLikes",function(){return{restrict:"A",link:function(e,t,n){-1!=e.photo.likes.indexOf(e.currentUser._id)&&(e.liked=!0,e.like=!1)}}}),angular.module("scrapsApp").directive("pageFooter",function(){return{restrict:"E",templateUrl:"./directives/footer/footerTmpl.html"}}),angular.module("scrapsApp").directive("postPhoto",function(e,t,n,i){return{restrict:"A",link:function(n,o,r){o.bind("change",function(r){var a=new FileReader;a.onloadend=function(r){var a=r.target.result,s=o[0].value.split("\\"),l=s[s.length-1];e.storeImage(a,l,n.userInfo._id).then(function(e){n.newPhoto.postedBy=n.userInfo._id,n.newPhoto.image=e.Location;var o=n.newPhoto,r=n.userInfo.photos;t.savePhoto(o),r.unshift(o),i.go(i.current,{},{reload:!0})})["catch"](function(e){console.log(e)})},a.readAsDataURL(r.target.files[0])})}}}),angular.module("scrapsApp").directive("profilePicUpload",function(e,t){return{restrict:"A",link:function(n,i,o){i.bind("change",function(o){var r=new FileReader;r.onloadend=function(o){var r=o.target.result,a=i[0].value.split("\\"),s=a[a.length-1];e.storeImage(r,s,n.userInfo._id).then(function(e){n.userInfo.profilePic=e.Location,t.editProfile(n.userInfo)})["catch"](function(e){console.log(e)})},r.readAsDataURL(o.target.files[0])})}}}),angular.module("scrapsApp").directive("likeFollowingPhoto",function(e,t,n){return{restrict:"A",link:function(i,o,r){o.on("click",function(){t.likePhoto(i.post.photoId),i.like=!1,i.liked=!0,e.getFollowingPosts().then(function(e){i.posts=e,n.go(n.current,{},{reload:!0})})})}}}),angular.module("scrapsApp").directive("likePhoto",function(e,t,n){return{restrict:"A",link:function(i,o,r){o.on("click",function(){i.currentUser?(e.likePhoto(i.photo._id),this.like=!1,this.liked=!0,t.getUserInfo(i.userInfo.username).then(function(e){i.userInfo=e,n.go(n.current,{},{reload:!0})})):n.go("login")})}}}),angular.module("scrapsApp").directive("navBar",function(e){return{restrict:"E",templateUrl:"./directives/navbar/navTempl.html"}}),angular.module("scrapsApp").directive("photoCollage",function(){return{restrict:"E",templateUrl:"./directives/photoCollage/photoCollageTmpl.html"}}),angular.module("scrapsApp").directive("searchResults",function(e){return{restrict:"E",templateUrl:"./directives/search/searchTmpl.html",link:function(t,n,i){t.fullname=!0,e.getUsersForSearch().then(function(e){e=e.splice(0,5),t.searchUsers=e,t.searchUsers.forEach(function(e){e.name&&e.name.firstname?t.fullname=!0:t.fullname=!1})});var o=angular.element(document.querySelector(".search-input"));o.on("input",function(){var e=o.val().length;e>1?t.searchResults=!0:t.searchResults=!1})}}}),angular.module("scrapsApp").directive("unlikeFollowingPhoto",function(e,t,n){return{restrict:"A",link:function(i,o,r){o.on("click",function(){e.unlikePhoto(i.post.photo._id),i.like=!0,i.liked=!1,t.getFollowingPosts().then(function(e){i.posts=e,n.go(n.current,{},{reload:!0})})})}}}),angular.module("scrapsApp").directive("unlikePhoto",function(e,t,n){return{restrict:"A",link:function(i,o,r){o.on("click",function(){e.unlikePhoto(i.photo._id),i.like=!0,i.liked=!1,t.getUserInfo(i.userInfo.username).then(function(e){i.userInfo=e,n.go(n.current,{},{reload:!0})})})}}}),angular.module("scrapsApp").controller("authCtrl",function(e,t,n){e.currentUser=t,(!e.currentUser&&n.includes("login")||n.includes("register"))&&(e.loginBtn=!0,e.signUpBtn=!0),e.currentUser&&(e.profileLink=!0,e.logoutBtn=!0)}),angular.module("scrapsApp").controller("followingCtrl",function(e,t,n,i){e.currentUser=n,e.posts=t.sort(function(e,t){var n=new Date(e.createdAt),i=new Date(t.createdAt);return i-n}),console.log(e.posts),e.profileLink=!0,e.logoutBtn=!0,e.followingLink=!0,e.like=!0,e.openLightboxModal=function(t){i.openModal(e.posts,t)}}),angular.module("scrapsApp").controller("homeCtrl",function(e,t,n){e.currentUser=t,e.photos=n,console.log(n),e.loginBtn=!0,e.signUpBtn=!0,e.currentUser&&(e.loginBtn=!1,e.logoutBtn=!0,e.signUpBtn=!1,e.profileLink=!0,e.followingLink=!0)}),angular.module("scrapsApp").controller("photoModalCtrl",function(e){}),angular.module("scrapsApp").controller("settingsCtrl",function(e,t,n){function i(t){n.getUserInfo(t).then(function(t){e.currentUser=t})}e.profileLink=!0,e.logoutBtn=!0,e.followingLink=!0,e.currentUser=t,e.editProfile=function(){n.editProfile(e.currentUser),i(e.currentUser.username)}}),angular.module("scrapsApp").controller("userCtrl",function(e,t,n,i,o,r,a,s){if(e.currentUser=t,e.userInfo=i,e.newPhoto={},e.photos=e.userInfo.photos,e.photos.reverse(),e.photo={},e.like=!0,e.currentUser||(e.like=!0,e.liked=!1),e.followBtn=!0,e.editPhotoBtn=!1,e.loginBtn=!0,e.signUpBtn=!0,e.postCount=e.userInfo.photos.length,e.followersCount=e.userInfo.followers.length,e.followingCount=e.userInfo.following.length,e.currentUser){e.loginBtn=!1,e.signUpBtn=!1,e.logoutBtn=!0,e.profileLink=!0,e.followingLink=!0;for(var l=0;l<t.following.length;l++)e.currentUser.following[l]===e.userInfo._id&&(e.followBtn=!1,e.unfollowBtn=!0)}e.fullname=!0,e.userInfo.name||(e.fullname=!1),n.username===e.currentUser.username&&(e.editAccountBtn=!0,e.editPhotoBtn=!0,e.uploadProfilePicBtn=!0,e.uploadPhotoBtn=!0,e.userControls=!0,e.followBtn=!1),e.currentUser.photos>0&&e.currentUser._id===e.photos[0].postedBy._id&&(e.editPhotoBtn=!0),e.editPhotoEnabled=function(){this.photoEditOptions=!0,this.editPhotoBtn=!1,this.deletePhotoBtn=!0},e.cancelEditingPhoto=function(){this.photoEditOptions=!this.photoEditOptions,a.go(a.current,{},{reload:!0})},e.updatePhoto=function(e,t){o.editPhoto(e,t),a.go(a.current,{},{reload:!0})},e.deletePhoto=function(e){o.deletePhoto(e),a.go(a.current,{},{reload:!0})},e.followUser=function(){e.currentUser?(r.followUser(e.currentUser._id,e.userInfo._id),e.unfollowBtn=!0,e.followBtn=!1,r.getUserInfo(e.currentUser.username).then(function(t){e.currentUser=t,a.go(a.current,{},{reload:!0})})):a.go("login")},e.unfollowUser=function(){r.unfollowUser(e.currentUser._id,e.userInfo._id),e.unfollowBtn=!1,e.followBtn=!0,r.getUserInfo(e.currentUser.username).then(function(t){e.currentUser=t,a.go(a.current,{},{reload:!0})})},e.openLightboxModal=function(t){s.openModal(e.photos,t)}}),angular.module("bootstrapLightbox",["ui.bootstrap"]);try{angular.module("angular-loading-bar"),angular.module("bootstrapLightbox").requires.push("angular-loading-bar")}catch(e){}try{angular.module("ngTouch"),angular.module("bootstrapLightbox").requires.push("ngTouch")}catch(e){}try{angular.module("videosharing-embed"),angular.module("bootstrapLightbox").requires.push("videosharing-embed")}catch(e){}angular.module("bootstrapLightbox").run(["$templateCache",function(e){"use strict";e.put("lightbox.html",'<div class=modal-body ng-swipe-left=Lightbox.nextImage() ng-swipe-right=Lightbox.prevImage()><div class=lightbox-nav><button class=close aria-hidden=true ng-click=$dismiss()>×</button><div class=btn-group ng-if="Lightbox.images.length > 1"><a class="btn btn-xs btn-default" ng-click=Lightbox.prevImage()>‹ Previous</a> <a ng-href={{Lightbox.imageUrl}} target=_blank class="btn btn-xs btn-default" title="Open in new tab">Open image in new tab</a> <a class="btn btn-xs btn-default" ng-click=Lightbox.nextImage()>Next ›</a></div></div><div class=lightbox-image-container><div class=lightbox-image-caption><span>{{Lightbox.imageCaption}}</span></div><img ng-if=!Lightbox.isVideo(Lightbox.image) lightbox-src={{Lightbox.imageUrl}}><div ng-if=Lightbox.isVideo(Lightbox.image) class="embed-responsive embed-responsive-16by9"><video ng-if=!Lightbox.isSharedVideo(Lightbox.image) lightbox-src={{Lightbox.imageUrl}} controls autoplay></video><embed-video ng-if=Lightbox.isSharedVideo(Lightbox.image) lightbox-src={{Lightbox.imageUrl}} ng-href={{Lightbox.imageUrl}} iframe-id=lightbox-video class=embed-responsive-item><a ng-href={{Lightbox.imageUrl}}>Watch video</a></embed-video></div></div></div>')}]),angular.module("bootstrapLightbox").service("ImageLoader",["$q",function(e){this.load=function(t){var n=e.defer(),i=new Image;return i.onload=function(){("boolean"==typeof this.complete&&this.complete===!1||"number"==typeof this.naturalWidth&&0===this.naturalWidth)&&n.reject(),n.resolve(i)},i.onerror=function(){n.reject()},i.src=t,n.promise}}]),angular.module("bootstrapLightbox").provider("Lightbox",function(){this.templateUrl="lightbox.html",this.fullScreenMode=!1,this.getImageUrl=function(e){return"string"==typeof e?e:e.image},this.getImageCaption=function(e){return e.description},this.calculateImageDimensionLimits=function(e){return e.windowWidth>=768?{maxWidth:e.windowWidth-92,maxHeight:e.windowHeight-126}:{maxWidth:e.windowWidth-52,maxHeight:e.windowHeight-86}},this.calculateModalDimensions=function(e){var t=Math.max(400,e.imageDisplayWidth+32),n=Math.max(200,e.imageDisplayHeight+66);return(t>=e.windowWidth-20||e.windowWidth<768)&&(t="auto"),n>=e.windowHeight&&(n="auto"),{width:t,height:n}},this.isVideo=function(e){return"object"==typeof e&&e&&e.type?"video"===e.type:!1},this.isSharedVideo=function(e){return this.isVideo(e)&&!this.getImageUrl(e).match(/\.(mp4|ogg|webm)$/)},this.$get=["$document","$injector","$uibModal","$timeout","ImageLoader",function(e,t,n,i,o){var r=t.has("cfpLoadingBar")?t.get("cfpLoadingBar"):null,a={};return a.images=[],a.index=0,a.templateUrl=this.templateUrl,a.fullScreenMode=this.fullScreenMode,a.getImageUrl=this.getImageUrl,a.getImageCaption=this.getImageCaption,a.calculateImageDimensionLimits=this.calculateImageDimensionLimits,a.calculateModalDimensions=this.calculateModalDimensions,a.isVideo=this.isVideo,a.isSharedVideo=this.isSharedVideo,a.keyboardNavEnabled=!1,a.image={},a.modalInstance=null,a.loading=!1,a.openModal=function(e,t,i){return a.images=e,a.setImage(t),a.modalInstance=n.open(angular.extend({templateUrl:a.templateUrl,controller:["$scope",function(e){e.Lightbox=a,a.keyboardNavEnabled=!0}],windowClass:"lightbox-modal"},i||{})),a.modalInstance.result["finally"](function(){a.images=[],a.index=1,a.image={},a.imageUrl=null,a.imageCaption=null,a.keyboardNavEnabled=!1,r&&r.complete()}),a.modalInstance},a.closeModal=function(e){return a.modalInstance.close(e)},a.setImage=function(e){if(!(e in a.images))throw"Invalid image.";a.loading=!0,r&&r.start();var t=a.images[e],n=a.getImageUrl(t),i=function(i){i=i||{},a.index=i.index||e,a.image=i.image||t,a.imageUrl=i.imageUrl||n,a.imageCaption=i.imageCaption||a.getImageCaption(t),a.loading=!1,r&&r.complete()};a.isVideo(t)?i():o.load(n).then(function(){i()},function(){i({imageUrl:"#",imageCaption:"Failed to load image"})})},a.firstImage=function(){a.setImage(0)},a.prevImage=function(){a.setImage((a.index-1+a.images.length)%a.images.length)},a.nextImage=function(){a.setImage((a.index+1)%a.images.length)},a.lastImage=function(){a.setImage(a.images.length-1)},a.setImages=function(e){a.images=e,a.setImage(a.index)},e.bind("keydown",function(e){if(a.keyboardNavEnabled){var t=null;switch(e.which){case 39:t="nextImage";break;case 37:t="prevImage"}null!==t&&-1===["input","textarea"].indexOf(e.target.tagName.toLowerCase())&&(i(function(){a[t]()}),e.preventDefault())}}),a}]}),angular.module("bootstrapLightbox").directive("lightboxSrc",["$window","ImageLoader","Lightbox",function(e,t,n){var i=function(e,t){var n=e.width,i=e.height,o=e.minWidth,r=e.minHeight,a=e.maxWidth,s=e.maxHeight,l=n,u=i;if(t){var c=Math.min(a/n,s/i),g=Math.round(n*c),d=Math.round(i*c);l=Math.max(o,g),u=Math.max(r,d)}else o>n&&r>i?n/i>a/s?(u=r,l=Math.round(n*r/i)):(l=o,u=Math.round(i*o/n)):o>n?(l=o,u=Math.round(i*o/n)):r>i&&(u=r,l=Math.round(n*r/i)),n>a&&i>s?n/i>a/s?(l=a,u=Math.round(i*a/n)):(u=s,l=Math.round(n*s/i)):n>a?(l=a,u=Math.round(i*a/n)):i>s&&(u=s,l=Math.round(n*s/i));return{width:l||0,height:u||0}},o=function(e){return"number"==typeof e?e+"px":e},r=0,a=0;return{link:function(s,l,u){var c=function(){var t=e.innerWidth,s=e.innerHeight,u=n.calculateImageDimensionLimits({windowWidth:t,windowHeight:s,imageWidth:r,imageHeight:a}),c=i(angular.extend({width:r,height:a,minWidth:1,minHeight:1,maxWidth:3e3,maxHeight:3e3},u),n.fullScreenMode),g=n.calculateModalDimensions({windowWidth:t,windowHeight:s,imageDisplayWidth:c.width,imageDisplayHeight:c.height});l.css({width:c.width+"px",height:c.height+"px"}),angular.element(document.querySelector(".lightbox-modal .modal-dialog")).css({width:o(g.width)}),angular.element(document.querySelector(".lightbox-modal .modal-content")).css({height:o(g.height)})};s.$watch(function(){return u.lightboxSrc},function(e){if(n.image)if(n.isVideo(n.image))r=1280,a=720,c(),l[0].src=e;else{l[0].src="#";var i=function(){r=0,a=0,c()};e?t.load(e).then(function(t){r=t.naturalWidth,a=t.naturalHeight,c(),l[0].src=e},i):i()}}),angular.element(e).on("resize",c)}}}]),!function(e){"use strict";var t=function(e,n,i){var o,r,a=document.createElement("img");if(a.onerror=n,a.onload=function(){!r||i&&i.noRevoke||t.revokeObjectURL(r),n&&n(t.scale(a,i))},t.isInstanceOf("Blob",e)||t.isInstanceOf("File",e))o=r=t.createObjectURL(e),a._type=e.type;else{if("string"!=typeof e)return!1;o=e,i&&i.crossOrigin&&(a.crossOrigin=i.crossOrigin)}return o?(a.src=o,a):t.readFile(e,function(e){var t=e.target;t&&t.result?a.src=t.result:n&&n(e)})},n=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;t.isInstanceOf=function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},t.transformCoordinates=function(){},t.getTransformedOptions=function(e,t){var n,i,o,r,a=t.aspectRatio;if(!a)return t;n={};for(i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n.crop=!0,o=e.naturalWidth||e.width,r=e.naturalHeight||e.height,o/r>a?(n.maxWidth=r*a,n.maxHeight=r):(n.maxWidth=o,n.maxHeight=o/a),n},t.renderImageToCanvas=function(e,t,n,i,o,r,a,s,l,u){return e.getContext("2d").drawImage(t,n,i,o,r,a,s,l,u),e},t.hasCanvasOption=function(e){return e.canvas||e.crop||!!e.aspectRatio},t.scale=function(e,n){function i(){var e=Math.max((s||w)/w,(l||S)/S);e>1&&(w*=e,S*=e)}function o(){var e=Math.min((r||w)/w,(a||S)/S);1>e&&(w*=e,S*=e)}n=n||{};var r,a,s,l,u,c,g,d,h,f,m,p=document.createElement("canvas"),v=e.getContext||t.hasCanvasOption(n)&&p.getContext,b=e.naturalWidth||e.width,x=e.naturalHeight||e.height,w=b,S=x;if(v&&(n=t.getTransformedOptions(e,n),g=n.left||0,d=n.top||0,n.sourceWidth?(u=n.sourceWidth,void 0!==n.right&&void 0===n.left&&(g=b-u-n.right)):u=b-g-(n.right||0),n.sourceHeight?(c=n.sourceHeight,void 0!==n.bottom&&void 0===n.top&&(d=x-c-n.bottom)):c=x-d-(n.bottom||0),w=u,S=c),r=n.maxWidth,a=n.maxHeight,s=n.minWidth,l=n.minHeight,v&&r&&a&&n.crop?(w=r,S=a,m=u/c-r/a,0>m?(c=a*u/r,void 0===n.top&&void 0===n.bottom&&(d=(x-c)/2)):m>0&&(u=r*c/a,void 0===n.left&&void 0===n.right&&(g=(b-u)/2))):((n.contain||n.cover)&&(s=r=r||s,l=a=a||l),n.cover?(o(),i()):(i(),o())),v){if(h=n.pixelRatio,h>1&&(p.style.width=w+"px",p.style.height=S+"px",w*=h,S*=h,p.getContext("2d").scale(h,h)),f=n.downsamplingRatio,f>0&&1>f&&u>w&&c>S)for(;u*f>w;)p.width=u*f,p.height=c*f,t.renderImageToCanvas(p,e,g,d,u,c,0,0,p.width,p.height),u=p.width,c=p.height,e=document.createElement("canvas"),e.width=u,e.height=c,t.renderImageToCanvas(e,p,0,0,u,c,0,0,u,c);return p.width=w,p.height=S,t.transformCoordinates(p,n),t.renderImageToCanvas(p,e,g,d,u,c,0,0,w,S)}return e.width=w,e.height=S,e},t.createObjectURL=function(e){return n?n.createObjectURL(e):!1},t.revokeObjectURL=function(e){return n?n.revokeObjectURL(e):!1},t.readFile=function(e,t,n){if(window.FileReader){var i=new FileReader;if(i.onload=i.onerror=t,n=n||"readAsDataURL",i[n])return i[n](e),i}return!1},"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:e.loadImage=t}(window),function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],e):e("object"==typeof module&&module.exports?require("./load-image"):window.loadImage)}(function(e){"use strict";var t=e.hasCanvasOption,n=e.transformCoordinates,i=e.getTransformedOptions;e.hasCanvasOption=function(n){return!!n.orientation||t.call(e,n)},e.transformCoordinates=function(t,i){n.call(e,t,i);var o=t.getContext("2d"),r=t.width,a=t.height,s=t.style.width,l=t.style.height,u=i.orientation;if(u&&!(u>8))switch(u>4&&(t.width=a,t.height=r,t.style.width=l,t.style.height=s),u){case 2:o.translate(r,0),o.scale(-1,1);break;case 3:o.translate(r,a),o.rotate(Math.PI);break;case 4:o.translate(0,a),o.scale(1,-1);break;case 5:o.rotate(.5*Math.PI),o.scale(1,-1);break;case 6:o.rotate(.5*Math.PI),o.translate(0,-a);break;case 7:o.rotate(.5*Math.PI),o.translate(r,-a),o.scale(-1,1);break;case 8:o.rotate(-.5*Math.PI),o.translate(-r,0)}},e.getTransformedOptions=function(t,n){var o,r,a=i.call(e,t,n),s=a.orientation;if(!s||s>8||1===s)return a;o={};for(r in a)a.hasOwnProperty(r)&&(o[r]=a[r]);switch(a.orientation){case 2:o.left=a.right,o.right=a.left;break;case 3:o.left=a.right,o.top=a.bottom,o.right=a.left,o.bottom=a.top;break;case 4:o.top=a.bottom,o.bottom=a.top;break;case 5:o.left=a.top,o.top=a.left,o.right=a.bottom,o.bottom=a.right;break;case 6:o.left=a.top,o.top=a.right,o.right=a.bottom,o.bottom=a.left;break;case 7:o.left=a.bottom,o.top=a.right,o.right=a.top,o.bottom=a.left;break;case 8:o.left=a.bottom,o.top=a.left,o.right=a.top,o.bottom=a.right}return a.orientation>4&&(o.maxWidth=a.maxHeight,o.maxHeight=a.maxWidth,o.minWidth=a.minHeight,o.minHeight=a.minWidth,o.sourceWidth=a.sourceHeight,o.sourceHeight=a.sourceWidth),o}}),function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],e):e("object"==typeof module&&module.exports?require("./load-image"):window.loadImage)}(function(e){"use strict";var t=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);e.blobSlice=t&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},e.metaDataParsers={jpeg:{65505:[]}},e.parseMetaData=function(t,n,i){i=i||{};var o=this,r=i.maxMetaDataSize||262144,a={},s=!(window.DataView&&t&&t.size>=12&&"image/jpeg"===t.type&&e.blobSlice);(s||!e.readFile(e.blobSlice.call(t,0,r),function(t){if(t.target.error)return console.log(t.target.error),void n(a);var r,s,l,u,c=t.target.result,g=new DataView(c),d=2,h=g.byteLength-4,f=d;if(65496===g.getUint16(0)){for(;h>d&&(r=g.getUint16(d),r>=65504&&65519>=r||65534===r);){if(s=g.getUint16(d+2)+2,d+s>g.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if(l=e.metaDataParsers.jpeg[r])for(u=0;u<l.length;u+=1)l[u].call(o,g,d,s,a,i);d+=s,f=d}!i.disableImageHead&&f>6&&(c.slice?a.imageHead=c.slice(0,f):a.imageHead=new Uint8Array(c).subarray(0,f))}else console.log("Invalid JPEG file: Missing JPEG marker.");n(a)},"readAsArrayBuffer"))&&n(a)}}),function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-meta"],e):"object"==typeof module&&module.exports?e(require("./load-image"),require("./load-image-meta")):e(window.loadImage)}(function(e){"use strict";e.ExifMap=function(){return this},e.ExifMap.prototype.map={Orientation:274},e.ExifMap.prototype.get=function(e){return this[e]||this[this.map[e]]},e.getExifThumbnail=function(e,t,n){var i,o,r;if(!n||t+n>e.byteLength)return void console.log("Invalid Exif data: Invalid thumbnail data.");for(i=[],o=0;n>o;o+=1)r=e.getUint8(t+o),i.push((16>r?"0":"")+r.toString(16));return"data:image/jpeg,%"+i.join("%")},e.exifTagTypes={1:{getValue:function(e,t){return e.getUint8(t)},size:1},2:{getValue:function(e,t){return String.fromCharCode(e.getUint8(t))},size:1,ascii:!0},3:{getValue:function(e,t,n){return e.getUint16(t,n)},size:2},4:{getValue:function(e,t,n){return e.getUint32(t,n)},size:4},5:{getValue:function(e,t,n){return e.getUint32(t,n)/e.getUint32(t+4,n)},size:8},9:{getValue:function(e,t,n){return e.getInt32(t,n)},size:4},10:{getValue:function(e,t,n){return e.getInt32(t,n)/e.getInt32(t+4,n)},size:8}},e.exifTagTypes[7]=e.exifTagTypes[1],e.getExifValue=function(t,n,i,o,r,a){var s,l,u,c,g,d,h=e.exifTagTypes[o];if(!h)return void console.log("Invalid Exif data: Invalid tag type.");if(s=h.size*r,l=s>4?n+t.getUint32(i+8,a):i+8,l+s>t.byteLength)return void console.log("Invalid Exif data: Invalid data offset.");if(1===r)return h.getValue(t,l,a);for(u=[],c=0;r>c;c+=1)u[c]=h.getValue(t,l+c*h.size,a);if(h.ascii){for(g="",c=0;c<u.length&&(d=u[c],"\x00"!==d);c+=1)g+=d;return g}return u},e.parseExifTag=function(t,n,i,o,r){var a=t.getUint16(i,o);r.exif[a]=e.getExifValue(t,n,i,t.getUint16(i+2,o),t.getUint32(i+4,o),o)},e.parseExifTags=function(e,t,n,i,o){var r,a,s;if(n+6>e.byteLength)return void console.log("Invalid Exif data: Invalid directory offset.");if(r=e.getUint16(n,i),a=n+2+12*r,a+4>e.byteLength)return void console.log("Invalid Exif data: Invalid directory size.");for(s=0;r>s;s+=1)this.parseExifTag(e,t,n+2+12*s,i,o);return e.getUint32(a,i)},e.parseExifData=function(t,n,i,o,r){if(!r.disableExif){var a,s,l,u=n+10;if(1165519206===t.getUint32(n+4)){if(u+8>t.byteLength)return void console.log("Invalid Exif data: Invalid segment size.");if(0!==t.getUint16(n+8))return void console.log("Invalid Exif data: Missing byte alignment offset.");switch(t.getUint16(u)){case 18761:a=!0;break;case 19789:a=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}if(42!==t.getUint16(u+2,a))return void console.log("Invalid Exif data: Missing TIFF marker.");s=t.getUint32(u+4,a),o.exif=new e.ExifMap,s=e.parseExifTags(t,u,u+s,a,o),s&&!r.disableExifThumbnail&&(l={exif:{}},s=e.parseExifTags(t,u,u+s,a,l),l.exif[513]&&(o.exif.Thumbnail=e.getExifThumbnail(t,u+l.exif[513],l.exif[514]))),o.exif[34665]&&!r.disableExifSub&&e.parseExifTags(t,u,u+o.exif[34665],a,o),o.exif[34853]&&!r.disableExifGps&&e.parseExifTags(t,u,u+o.exif[34853],a,o)}}},e.metaDataParsers.jpeg[65505].push(e.parseExifData)}),function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-exif"],e):"object"==typeof module&&module.exports?e(require("./load-image"),require("./load-image-exif")):e(window.loadImage)}(function(e){"use strict";e.ExifMap.prototype.tags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright",36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",42240:"Gamma",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"PhotographicSensitivity",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},e.ExifMap.prototype.stringValues={ExposureProgram:{0:"Undefined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Undefined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},ComponentsConfiguration:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"},Orientation:{1:"top-left",2:"top-right",3:"bottom-right",4:"bottom-left",5:"left-top",6:"right-top",7:"right-bottom",8:"left-bottom"}},e.ExifMap.prototype.getText=function(e){var t=this.get(e);switch(e){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":case"Orientation":return this.stringValues[e][t];case"ExifVersion":case"FlashpixVersion":return String.fromCharCode(t[0],t[1],t[2],t[3]);case"ComponentsConfiguration":return this.stringValues[e][t[0]]+this.stringValues[e][t[1]]+this.stringValues[e][t[2]]+this.stringValues[e][t[3]];case"GPSVersionID":return t[0]+"."+t[1]+"."+t[2]+"."+t[3]}return String(t)},function(e){var t,n=e.tags,i=e.map;for(t in n)n.hasOwnProperty(t)&&(i[n[t]]=t)}(e.ExifMap.prototype),e.ExifMap.prototype.getAll=function(){var e,t,n={};for(e in this)this.hasOwnProperty(e)&&(t=this.tags[e],t&&(n[t]=this.getText(t)));return n}}),angular.module("scrapsApp").service("authSvc",function(e,t){this.getCurrentUser=function(){return e.get("/auth/currentUser").then(function(e){return e.data})}}),angular.module("scrapsApp").service("followingSvc",function(e){this.getFollowingPosts=function(){return e.get("/api/v1/following").then(function(e){function t(e){for(var t=0;t<e.length;t++)if(e[t].photos.length>=1)for(var i=0;i<e[t].photos.length;i++){var r=e[t].photos[i];n={username:e[t].username,profilePic:e[t].profilePic,image:r.image,createdAt:r.createdAt,description:r.description,likes:r.likes,photoId:r._id},o.push(n)}return o}var n,i=e.data.following,o=[],r=t(i);return r})}}),angular.module("scrapsApp").service("imageUploadSvc",function(e){this.storeImage=function(t,n,i){var o=t.split(";")[0].split("/");o=o[o.length-1];var r={imageName:n,imageBody:t,imageExtension:o,userId:i};return e.post("/api/v1/uploadImg",r).then(function(e){return e.data})}}),angular.module("scrapsApp").service("postSvc",function(e){this.savePhoto=function(t){return e.post("/api/v1/photo",t)},this.editPhoto=function(t,n){return e.put("/api/v1/photo/"+n,t)},this.deletePhoto=function(t){e["delete"]("/api/v1/photo/"+t)},this.likePhoto=function(t){
return console.log(t),e.put("/api/v1/photo/"+t+"/likes")},this.unlikePhoto=function(t){return console.log(t),e.put("/api/v1/photo/"+t+"/unlike")},this.getPhotos=function(){return e.get("/api/v1/photos").then(function(e){console.log(e);var t=e.data,n=t.reverse(),i=n.splice(0,12);return console.log(i),i})}}),angular.module("scrapsApp").service("userSvc",function(e){this.getUserInfo=function(t){return e.get("/api/v1/users?username="+t).then(function(e){return e.data[0]})},this.getUsersPhotos=function(t){return e.get("/api/v1/users?username="+t).then(function(e){var t=e.data[0].photos;return t})},this.editProfile=function(t){e.put("/api/v1/user/"+t._id,t)},this.getUsersForSearch=function(){return e.get("/api/v1/users").then(function(e){var t=[];return e.data.forEach(function(e){var n={name:e.name,username:e.username,profilePic:e.profilePic};e=n,t.push(e)}),t})},this.followUser=function(t,n){console.log(t,n),e.put("/api/v1/user/"+t+"/following",{userToFollow:n,currentUserId:t})},this.unfollowUser=function(t,n){console.log(n),e.put("/api/v1/user/"+t+"/unfollow",{id:n})}});
